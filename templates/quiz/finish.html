{% extends "base.html" %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞{% endblock %}

{% block content %}
<div class="result-container">
    <!-- –ò–∫–æ–Ω–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
    <div style="font-size: 5em; margin-bottom: 20px;">
        {% if percentage >= 80 %}
            üèÜ
        {% elif percentage >= 60 %}
            üéâ
        {% elif percentage >= 40 %}
            üëç
        {% else %}
            üí™
        {% endif %}
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div class="result-score">
        {{ correct_answers }}/{{ total_questions }}
    </div>
    
    <div class="result-percentage">
        {{ percentage|floatformat:1 }}%
    </div>
    
    <!-- –û—Ü–µ–Ω–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
    <div style="margin-bottom: 30px;">
        {% if percentage >= 90 %}
            <h3 style="color: #2d7d32; font-size: 1.5em;">–û—Ç–ª–∏—á–Ω–æ! üåü</h3>
            <p style="color: #4a5568;">–ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –í—ã –æ—Ç–ª–∏—á–Ω–æ –∑–Ω–∞–µ—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª.</p>
        {% elif percentage >= 80 %}
            <h3 style="color: #2e7d32; font-size: 1.5em;">–•–æ—Ä–æ—à–æ! üëè</h3>
            <p style="color: #4a5568;">–û—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –í—ã —Ö–æ—Ä–æ—à–æ —É—Å–≤–æ–∏–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª.</p>
        {% elif percentage >= 70 %}
            <h3 style="color: #f57f17; font-size: 1.5em;">–ù–µ–ø–ª–æ—Ö–æ! üëç</h3>
            <p style="color: #4a5568;">–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω–æ –µ—Å—Ç—å –∫—É–¥–∞ —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è.</p>
        {% elif percentage >= 60 %}
            <h3 style="color: #f57c00; font-size: 1.5em;">–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ üìö</h3>
            <p style="color: #4a5568;">–†–µ–∑—É–ª—å—Ç–∞—Ç —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª.</p>
        {% elif percentage >= 40 %}
            <h3 style="color: #e65100; font-size: 1.5em;">–ù—É–∂–Ω–æ —Å—Ç–∞—Ä–∞—Ç—å—Å—è –±–æ–ª—å—à–µ üìñ</h3>
            <p style="color: #4a5568;">–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π, —Å—Ç–æ–∏—Ç —É–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è –∏–∑—É—á–µ–Ω–∏—é –ø—Ä–µ–¥–º–µ—Ç–∞.</p>
        {% else %}
            <h3 style="color: #d32f2f; font-size: 1.5em;">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑! üí™</h3>
            <p style="color: #4a5568;">–ù–µ —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ—Å—å! –ö–∞–∂–¥–∞—è –ø–æ–ø—ã—Ç–∫–∞ –¥–µ–ª–∞–µ—Ç –≤–∞—Å —Å–∏–ª—å–Ω–µ–µ.</p>
        {% endif %}
    </div>
    
    <!-- –î–µ—Ç–∞–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
    <div class="result-details">
        <div class="result-item">
            <span>üë§ –§–ò–û —É—á–µ–Ω–∏–∫–∞:</span>
            <strong>{{ student_test.student_name }}</strong>
        </div>
        <div class="result-item">
            <span>üéì –ö–ª–∞—Å—Å:</span>
            <strong>{{ student_test.student_class }}</strong>
        </div>
        <div class="result-item">
            <span>üìö –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞:</span>
            <strong>{{ student_test.test.title }}</strong>
        </div>
        <div class="result-item">
            <span>‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:</span>
            <strong style="color: #2e7d32;">{{ correct_answers }}</strong>
        </div>
        <div class="result-item">
            <span>‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:</span>
            <strong style="color: #d32f2f;">{{ wrong_answers }}</strong>
        </div>
        <div class="result-item">
            <span>üìä –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:</span>
            <strong style="color: #1976d2;">{{ percentage|floatformat:1 }}%</strong>
        </div>
        <div class="result-item">
            <span>‚è∞ –í—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è:</span>
            <strong>
                {% if student_test.completed_at %}
                    {{ student_test.completed_at|timesince:student_test.started_at }}
                {% else %}
                    –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
                {% endif %}
            </strong>
        </div>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div style="margin-top: 30px;">
        <a href="{% url 'home' %}" class="btn" style="margin: 0 10px;">
            üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é
        </a>
        <button onclick="window.print()" class="btn btn-secondary" style="margin: 0 10px;">
            üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        </button>
    </div>
</div>

<!-- –ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤ -->
{% if student_answers %}
<div class="card">
    <h3 style="color: #2d3748; margin-bottom: 20px; text-align: center;">üìã –ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä –æ—Ç–≤–µ—Ç–æ–≤</h3>
    
    <div style="max-height: 400px; overflow-y: auto;">
        {% for student_answer in student_answers %}
        <div style="border: 1px solid #e2e8f0; border-radius: 10px; padding: 20px; margin-bottom: 15px; background: {% if student_answer.is_correct %}rgba(72, 187, 120, 0.1){% else %}rgba(245, 101, 101, 0.1){% endif %};">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <strong style="color: #2d3748;">–í–æ–ø—Ä–æ—Å {{ forloop.counter }}</strong>
                <span style="background: {% if student_answer.is_correct %}#48bb78{% else %}#f56565{% endif %}; color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 600;">
                    {% if student_answer.is_correct %}‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ{% else %}‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ{% endif %}
                </span>
            </div>
            
            <p style="color: #4a5568; margin-bottom: 15px; line-height: 1.5;">
                {{ student_answer.question.text }}
            </p>
            
            <div style="margin-bottom: 10px;">
                <strong style="color: #2d3748;">–í–∞—à –æ—Ç–≤–µ—Ç:</strong>
                <span style="color: {% if student_answer.is_correct %}#2e7d32{% else %}#d32f2f{% endif %};">
                    {{ student_answer.selected_answer.letter }}. {{ student_answer.selected_answer.text }}
                </span>
            </div>
            
            {% if not student_answer.is_correct %}
                {% for answer in student_answer.question.answers.all %}
                    {% if answer.is_correct %}
                    <div>
                        <strong style="color: #2e7d32;">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</strong>
                        <span style="color: #2e7d32;">{{ answer.letter }}. {{ answer.text }}</span>
                    </div>
                    {% endif %}
                {% endfor %}
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
<div style="background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 15px; padding: 30px; text-align: center; color: white; margin-top: 30px;">
    <h3 style="margin-bottom: 15px; font-size: 1.5em;">üí° –°–æ–≤–µ—Ç –Ω–∞ –±—É–¥—É—â–µ–µ</h3>
    <p style="font-size: 1.1em; line-height: 1.6; margin: 0;">
        {% if percentage >= 80 %}
            –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ –∏ —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ –Ω–æ–≤—ã–º –∑–Ω–∞–Ω–∏—è–º!
        {% elif percentage >= 60 %}
            –•–æ—Ä–æ—à–∞—è —Ä–∞–±–æ—Ç–∞! –ù–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ –ø—Ä–∞–∫—Ç–∏–∫–∏, –∏ –≤—ã –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç–µ –æ—Ç–ª–∏—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤!
        {% else %}
            –ù–µ —Å–¥–∞–≤–∞–π—Ç–µ—Å—å! –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç - —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç—å –ª—É—á—à–µ. –£–¥–∞—á–∏ –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑!
        {% endif %}
    </p>
</div>
{% endblock %}
